* zoneminder-aur wiki
  
* Introduction
* Step by step
** DONE BUILD the zoneminder package
*** DONE Build zoneminder dependencies which are in the AUR
    1. [X] Download the AUR dependencies
       Here's a helper script to download the PKGBUILDS from the AUR:
       #+BEGIN_SRC sh :tangle bin/download-aur-tarballs.sh :shebang #!/bin/bash
         # script to download Zoneminder dependency build tarballs from AUR
         mkdir --parent aur && cd aur
         wget https://aur.archlinux.org/packages/ca/cambozola/cambozola.tar.gz
         wget https://aur.archlinux.org/packages/pe/perl-astro-suntime/perl-astro-suntime.tar.gz
         # wget https://aur.archlinux.org/packages/pe/perl-time-parsedate/perl-time-parsedate.tar.gz
         wget https://aur.archlinux.org/packages/pe/perl-expect/perl-expect.tar.gz
         wget https://aur.archlinux.org/packages/pe/perl-net-sftp-foreign/perl-net-sftp-foreign.tar.gz
         wget https://aur.archlinux.org/packages/pe/perl-php-serialization/perl-php-serialization.tar.gz
         wget https://aur.archlinux.org/packages/pe/perl-sys-mmap/perl-sys-mmap.tar.gz
         wget https://aur.archlinux.org/packages/pe/perl-x10/perl-x10.tar.gz
       #+END_SRC
    2. [X] Build and install [[https://aur.archlinux.org/packages/perl-astro-suntime][perl-astro-suntime]]
       1. [X] Download https://aur.archlinux.org/packages/pe/perl-astro-suntime/perl-astro-suntime.tar.gz
       2. [X] Unpack
       3. [X] Change the dependency to perl-time-modules
    3. [X] Build and install [[https://aur.archlinux.org/packages/cambozola][cambozola]]
    4. [X] Build and install perl-expect
    5. [X] Build and install perl-net-sftp-foreign
    6. [X] Build and install perl-php-serialization
    7. [X] Build and install perl-sys-mmap
    8. [X] Build and install perl-x10
*** DONE Build and install the zoneminder package
    #+BEGIN_SRC sh
      makepkg -s
    #+END_SRC
    #+BEGIN_SRC sh
      sudo pacman --upgrade ./zoneminder-1.27.0-5-i686.pkg.tar.xz    
    #+END_SRC
** DONE Configure Apache and PHP
   CLOSED: [2014-09-27 Sat 11:29]
   1. (Optional, recommended) Copy config files
      #+BEGIN_SRC sh :tangle bin/make.post.zoneminder.install.backups :shebang #!/bin/bash
	set -o errexit
	set -o verbose
	cd ../config
	cp -i /etc/php/php.ini php.ini.post.zoneminder.install
	cp -i /etc/httpd/conf/httpd.conf httpd.conf.post.zoneminder.install
      #+END_SRC
   2. [X] Configure /etc/httpd/conf/httpd.conf
      1. (Optional, recomended) Read primary documentation https://wiki.archlinux.org/index.php/Apache_HTTP_Server#PHP
      2. [X] Configure httpd.conf file:/etc/httpd/conf/httpd.conf:
	 1. [X] To use mod_mpm_prefork, open file:/etc/httpd/conf/httpd.conf and replace
	    #+BEGIN_SRC conf
	      LoadModule mpm_event_module modules/mod_mpm_event.so
	    #+END_SRC
	    with
	    #+BEGIN_SRC conf
	      LoadModule mpm_prefork_module modules/mod_mpm_prefork.so
	    #+END_SRC
	 2. [X] Place this in the LoadModule list anywhere after LoadModule dir_module modules/mod_dir.so:
	    (Note: zoneminder.install attemps to do this but fails)
	    #+BEGIN_SRC conf
	      LoadModule php5_module modules/libphp5.so
	    #+END_SRC
	 3. [X] Place this at the end of the Include list: (Note: zoneminder.install did this)
	    #+BEGIN_SRC conf
	      Include conf/extra/php5_module.conf
	    #+END_SRC
	 4. [X] Place this at the end of the Include list: (Note: zoneminder.install did this)
	    #+BEGIN_SRC conf
	      Include /etc/httpd/conf/extra/httpd-zoneminder.conf
	    #+END_SRC
	 5. [X] Enable 
	    #+BEGIN_SRC conf
	      LoadModule cgi_module modules/mod_cgi.so           
	    #+END_SRC
	    See http://httpd.apache.org/docs/current/howto/cgi.html
	    Search for "cgi_module" Google => site:https://wiki.archlinux.org cgi_module
   3. [X] Configure file://etc/php/php.ini
      #+BEGIN_SRC conf
	open_basedir = /srv/http/:/home/:/tmp/:/usr/share/pear/:/usr/share/webapps/:/etc:/srv/http/zoneminder:/var/cache/zoneminder
      #+END_SRC
** DONE Setting up the zoneminder database in MySQL
   1. [X] Start mysql server
	 #+BEGIN_SRC sh
	   systemctl restart mysqld
	 #+END_SRC
   2. [X] add Zoneminder database
      #+BEGIN_SRC sh :tangle bin/mysql-setup.sh :shebang #!/usr/bin/bash
	set -o verbose
	mysqladmin --defaults-file=/etc/mysql/my.cnf -p -f reload
	cat /usr/share/zoneminder/db/zm_create.sql | mysql --defaults-file=/etc/mysql/my.cnf -p
	echo 'grant lock tables, alter,select,insert,update,delete on zm.* to 'zmuser'@localhost identified by "zmpass";' | mysql --defaults-file=/etc/mysql/my.cnf -p mysql
      #+END_SRC
** DONE Start the zoneminder service
   1. [X] systemctl start zoneminder
      #+BEGIN_SRC sh :tangle bin/restart-everything.sh :shebang #!/bin/bash
	systemctl restart mysqld
	systemctl restart httpd
	systemctl restart zoneminder
      #+END_SRC
* Chunks
** CONTRIBUTORS
   #+NAME: CONTRIBUTORS
   #+BEGIN_SRC conf :padline no
     # Contributor: Troy Will                 <troydwill@gmail.com>
     # Contributor: /dev/rs0                  </dev/rs0@secretco.de.com>
     # Contributor: Jacek Burghardt           <jacek@hebe.us>
     # Contributor: Vojtech Aschenbrenner     <v@asch.cz>
     # Contributor: Jason Gardner             <buhrietoe@gmail.com>
     # Contributor: Ross melin                <rdmelin@gmail.com>
     # Contributor (Parabola): Márcio Silva   <coadde@lavabit.com>
     # Contributor (Parabola): André Silva    <emulatorman@lavabit.com>
   #+END_SRC
** pkgver-git
   #+NAME: pkgver-git
   #+BEGIN_SRC sh
     pkgver() {
         cd "$srcdir/$_gitname"
         printf "%s.r%s.%s.%s" "$pkgver" "$(git rev-list --count HEAD)" "$pkgrel" "$(git rev-parse --short HEAD)"
     }
   #+END_SRC

** PACKAGE VERSION DATA
   #+NAME: PACKAGE_VERSION_DATA
   #+BEGIN_SRC sh
     pkgbase=zoneminder
     pkgname=zoneminder
     pkgver=1.27.0
     pkgrel=5
     pkgdesc='Capture, analyse, record and monitor video security cameras'
     arch=( i686 x86_64 mips64el arm )
   #+END_SRC

** DEPENDENCIES
   #+NAME: DEPENDENCIES
   #+BEGIN_SRC sh
     depends=(
         apache
         cambozola
         gnutls
         mariadb
         perl-archive-zip
         perl-date-manip
         perl-dbd-mysql
         perl-dbi
         perl-expect
         perl-libwww
         perl-mime-lite
         perl-mime-tools
         perl-php-serialization
         perl-net-sftp-foreign
         perl-sys-mmap
         perl-time-modules
         perl-x10
         php
         php-apache
         php-gd
         php-mcrypt
     )

     makedepends=(
         netpbm
         cmake
     )

     optdepends=(
         netpbm
     )
   #+END_SRC
** SOURCES
   See https://github.com/ZoneMinder/ZoneMinder/releases
   
   #+NAME: SOURCES
   #+BEGIN_SRC sh
     source=(
         https://github.com/ZoneMinder/ZoneMinder/archive/v$pkgver.tar.gz
         httpd-zoneminder.conf
         zoneminder.service
     )

     sha512sums=('8a349558399381a9062365ddc8bd8f815e3800929914096b2e4ea63e4d6dd12054f7b849fab5bea4bcfc87ea60739479a55734c7075a74aab0622d35f1d2bb14'
                 'fb9bf263c37fae30d775872a33cb319f2f2a7a4f38faff8c143253dbefd7278b295d0805e11ace6423a8ec2b50ef60f3426b6e6a53548c867ef7f109baa52c36'
                 '0dccb53546fb5d73dbcb9a868493f984b409b1f155ae2199c8b3e4a6f18c384a131cccec1c10d3d469d059f4d439cdddbd334a1dbcb2a787228d4359b2c8da02')

   #+END_SRC
   #+NAME: SOURCES-GIT
   #+BEGIN_SRC sh
     source=(
         git://github.com/$pkgname/$pkgname.git
         httpd-zoneminder.conf
         zoneminder.service
     )
     
     # Because the source is not static, skip Git checksum:        
     sha512sums=(
         'SKIP'
         'fb9bf263c37fae30d775872a33cb319f2f2a7a4f38faff8c143253dbefd7278b295d0805e11ace6423a8ec2b50ef60f3426b6e6a53548c867ef7f109baa52c36'
         '0dccb53546fb5d73dbcb9a868493f984b409b1f155ae2199c8b3e4a6f18c384a131cccec1c10d3d469d059f4d439cdddbd334a1dbcb2a787228d4359b2c8da02'
     )
   #+END_SRC
** httpd-zoneminder.conf file:/etc/httpd/conf/extra/httpd-zoneminder.conf
  #+NAME: httpd-zoneminder.conf
  #+BEGIN_SRC conf
    # /etc/httpd/conf/extra/httpd-zm.conf
    # Config for zoneminder web app

    Alias /zm "/srv/http/zoneminder"
    <Directory "/srv/http/zoneminder">
      Options -Indexes +MultiViews +FollowSymLinks
      AllowOverride None
      Order allow,deny
      Allow from all
      # The code unfortunately uses short tags in many places
      php_value short_open_tag On
    </Directory>

    ScriptAlias /cgi-bin "/srv/http/cgi-bin"
    <Directory "/srv/http/cgi-bin">
      AllowOverride None
      Options +ExecCGI +FollowSymLinks
      Order allow,deny
      Allow from all
    </Directory>
  #+END_SRC
** zoneminder.service
  #+NAME: zoneminder.service
  #+BEGIN_SRC conf
    # ZoneMinder systemd unit file
    # This file is intended to work with all Linux distributions
    
    [Unit]
    Description=ZoneMinder CCTV recording and security system
    After=network.target mysqld.service httpd.service
    Requires=mysqld.service httpd.service
    
    [Service]
    User=http
    Type=forking
    ExecStart=/usr/bin/zmpkg.pl start
    ExecReload=/usr/bin/zmpkg.pl restart
    ExecStop=/bin/bash -c '[[ "$(/usr/bin/pgrep zmdc.pl)" > 0 ]] && /usr/bin/zmpkg.pl stop'
    PIDFile="/var/run/zm/zm.pid"
    
    [Install]
    WantedBy=multi-user.target
  #+END_SRC
** zoneminder.install
   #+NAME: zoneminder.install
   #+BEGIN_SRC sh
     pre_install() {
	 set -e
	 abort=false
	 if [ -L /srv/http/zoneminder/events ]; then
	     l=$(readlink /srv/http/zoneminder/events)
	     if [ $l != /var/cache/zoneminder/events ]; then
		 abort=true
	     fi
	 fi
	 if [ -L /srv/http/zoneminder/images ]; then
	     l=$(readlink /srv/http/zoneminder/images)
	     if [ $l != /var/cache/zoneminder/images ]; then
		 abort=true
	     fi
	 fi
	 if [ $abort = true ]; then
	     cat >&2 << EOF
     Aborting installation of zoneminder due to non-default symlinks in
     /srv/http/zoneminder for the images and/or events directory, which could
     result in loss of data. Please move your data in each of these directories to
     /var/cache/zoneminder before installing zoneminder from the package.
     EOF
	     exit 1
	 fi
	 exit 0
     }
     
     post_install() {
	 if [[ -d /var/log/zoneminder ]]; then
	     chmod 0755 /var/log/zoneminder
	     chown http.http /var/log/zoneminder
	 else
	     mkdir -m 0755 /var/log/zoneminder
	     chown http.http /var/log/zoneminder
	 fi
	 if [[ -d /tmp/zoneminder ]]; then
	     chmod 0700 /tmp/zoneminder
	     chown http.http /tmp/zoneminder
	 else
	     mkdir -m 0700 /tmp/zoneminder
	     chown http.http /tmp/zoneminder
	 fi
     
	 # edit /etc/php.ini for Zoneminder
	 sed -e '
	 <<PHP.INI.SED>>
	 ' /etc/php/php.ini > /etc/php/php.ini.zoneminder
     
	 # edit /etc/httpd/conf/httpd.conf for Zoneminder
	 sed -e '
	 <<HTTPD.CONF.SED>>
	 ' /etc/httpd/conf/httpd.conf > /etc/httpd/conf/httpd.conf.zoneminder
	 
	 cat << EOF
     Note for mysql:
     ==> To run Zoneminder, you must install the database running mysql service (as root):
     ==> "rc.d start mysqld" (in initscripts) or "systemctl start mysqld.service" (in systemd)
     ==> and add Zoneminder database typing (with passsword):
     ==> "mysqladmin --defaults-file=/etc/mysql/my.cnf -p -f reload"
     ==> "cat /usr/share/zoneminder/db/zm_create.sql | mysql --defaults-file=/etc/mysql/my.cnf -p"
     ==> "echo 'grant lock tables, alter,select,insert,update,delete on zm.* to 'zmuser'@localhost identified by "zmpass";' | mysql --defaults-file=/etc/mysql/my.cnf -p mysql"
     ==> (or without passsword):
     ==> "mysqladmin --defaults-file=/etc/mysql/my.cnf -f reload"
     ==> "cat /usr/share/zoneminder/db/zm_create.sql | mysql --defaults-file=/etc/mysql/my.cnf"
     ==> "echo 'grant lock tables, alter,select,insert,update,delete on zm.* to 'zmuser'@localhost identified by "zmpass";' | mysql --defaults-file=/etc/mysql/my.cnf mysql"
     
     Note for php:
     ==> You must uncomment that line in /etc/php/php.ini:
     ==> "extension=mysql.so"
     ==> check and make sure these are uncommented:
     ==> "extension=gd.so"
     ==> "extension=gettext.so"
     ==> "extension=mcrypt.so"
     ==> "extension=mysqli.so"
     ==> "extension=session.so"
     ==> "extension=sockets.so"
     ==> "extension=openssl.so"
     ==> "extension=ftp.so"
     ==> "extension=zip.so"
     ==> check and add to open_basedir "/etc" and
     ==> "/srv/http/zoneminder" like so
     ==> "open_basedir = /home:/tmp:/usr/share/pear:/etc:/srv/http/zoneminder"
     ==> and set your timezone in php.ini:
     ==> "date.timezone = <your_country>/<your_city>"
     
     Note for apache:
     ==> You must edit /etc/httpd/conf/httpd.conf and add the line:
     ==> "LoadModule php5_module modules/libphp5.so"
     ==> and:
     ==> "Include /etc/httpd/conf/extra/php5_module.conf"
     ==> "Include /etc/httpd/conf/extra/httpd-zoneminder.conf"
     EOF
     }
     
     post_upgrade() {
	 post_install
	 /usr/bin/zmupdate.pl -f >/dev/null
     }
     
     post_remove() {
	 if [[ -d /tmp/zoneminder ]]; then
	     rm -vr /tmp/zoneminder
	 fi
	 sed -i -e '
	 /^open_basedir/ s/:\/srv\/http\/zoneminder//;
	 /^open_basedir/ s/:\/srv\/http\/zoneminder\///;
	 ' /etc/php/php.ini || read
	 sed -i -e '
	 /^# ZoneMinder/d;
	 /Include \/etc\/httpd\/conf\/extra\/httpd-zoneminder.conf/d;
	 ' /etc/httpd/conf/httpd.conf || read
	 cat << EOF
     Note:
     ==> To clean Zoneminder mysql database, run as root (with password):
     ==> "echo 'delete from user where User="zmuser";' | mysql --defaults-file=/etc/mysql/my.cnf -p mysql"
     ==> "echo 'delete from db where User="zmuser";' | mysql --defaults-file=/etc/mysql/my.cnf -p mysql"
     ==> "mysqladmin --defaults-file=/etc/mysql/my.cnf -p -f drop zm"
     ==> (or without password):
     ==> "echo 'delete from user where User="zmuser";' | mysql --defaults-file=/etc/mysql/my.cnf mysql"
     ==> "echo 'delete from db where User="zmuser";' | mysql --defaults-file=/etc/mysql/my.cnf mysql"
     ==> "mysqladmin --defaults-file=/etc/mysql/my.cnf -f drop zm"
     
     ==> Disable http with php if it isn't needed with others servers, 
     ==> comment or remove that lines in /etc/httpd/conf/httpd.conf:
     ==> "LoadModule php5_module modules/libphp5.so"
     ==> "Include /etc/httpd/conf/extra/php5_module.conf"
     
     ==> Remove line in /etc/httpd/conf/httpd.conf:
     ==> "Include /etc/httpd/conf/extra/httpd-zoneminder.conf"
     
     ==> Disable php with mysql if it isn't needed with others servers, 
     ==> comment that lines in /etc/php/php.ini:
     ==> "extension=mysql.so"
     ==> "extension=gd.so"
     ==> "extension=gettext.so"
     ==> "extension=mcrypt.so"
     ==> "extension=mysqli.so"
     ==> "extension=session.so"
     ==> "extension=sockets.so"
     ==> "date.timezone = <my_country>/<my_city>"
     
     ==> Edit /etc/php/php.ini and remove "/etc" and "/srv/http/zoneminder"
     ==> in the "open_basedir".
     
     ==> Remove log files and "zonemider" directory in "/var/log/zoneminder".
     
     ==> Backup and remove "events", "images" and "temp" dirs in "/var/cache/zoneminder".
     EOF
     }
   #+END_SRC
*** TODO
    1. fix /tmp/zoneminder
    2. 
** BUILD
*** Changelog
**** Removed --enable-crashtrace=no because "WARNING: unrecognized options: --enable-crashtrace"
**** 2014-09-28 ZM_RUNDIR		Location of transient process files, default: /var/run/zm
*** Config Table #1
|                     | Arch Linux                    | Debian Sid             |
|---------------------+-------------------------------+------------------------|
| --prefix            | /usr                          | /usr                   |
| --enable-crashtrace | no                            | no                     |
| --enable-debug      | no                            |                        |
| --enable-mmap       | yes                           | yes                    |
| --sysconfdir        | /etc                          | /etc/zm                |
| --with-cgidir       | /srv/http/cgi-bin             | /usr/lib/cgi-bin       |
| --with-extralibs    | '-L/usr/lib -L/usr/lib/mysql' |                        |
| --with-libarch      | lib                           |                        |
| --with-ffmpeg       | /usr                          |                        |
| --with-mysql        | /usr                          | /usr                   |
| --with-webdir       | /srv/http/$pkgbase            | /usr/share/zoneminder  |
| --with-webgroup     | http                          | www-data               |
| --with-webhost      | localhost                     |                        |
| --with-webuser      | http                          | www-data               |
| --host              |                               | $(DEB_HOST_GNU_TYPE)   |
| --build             |                               | $(DEB_BUILD_GNU_TYPE)  |
| --mandir            |                               | \$${prefix}/share/man  |
| --infodir           |                               | \$${prefix}/share/info |
| --ffmpeg            |                               | /usr                   |

*** Config Table #2
| ./configure         | Arch Linux ./configure        |   | CMAKE                             | CMAKE Default                       | Debian Sid             |
|---------------------+-------------------------------+---+-----------------------------------+-------------------------------------+------------------------|
| --prefix            | /usr                          | Y | CMAKE_INSTALL_PREFIX              |                                     | /usr                   |
| --enable-crashtrace | no                            | Y |                                   |                                     | no                     |
| --enable-debug      | no                            | N |                                   |                                     |                        |
| --enable-mmap       | yes                           | Y | ZM_NO_MMAP                        | default: OFF                        | yes                    |
| --sysconfdir        | /etc                          | N |                                   |                                     | /etc/zm                |
| --with-cgidir       | /srv/http/cgi-bin             | Y | ZM_CGIDIR                         | <prefix>/libexec/zoneminder/cgi-bin | /usr/lib/cgi-bin       |
| --with-extralibs    | '-L/usr/lib -L/usr/lib/mysql' | N | CMAKE_LIBRARY_PATH                |                                     |                        |
| --with-libarch      | lib                           | N |                                   |                                     |                        |
| --with-ffmpeg       | /usr                          | N |                                   |                                     |                        |
| --with-mysql        | /usr                          | N |                                   |                                     | /usr                   |
| --with-webdir       | /srv/http/zoneminder          | Y | ZM_WEBDIR                         | /usr/share/zoneminder/www           | /usr/share/zoneminder  |
| --with-webgroup     | http                          | N |                                   |                                     |                        |
| --with-webuser      | http                          | Y | ZM_WEB_USER                       |                                     | www-data               |
| --host              |                               |   |                                   |                                     | $(DEB_HOST_GNU_TYPE)   |
| --build             |                               |   |                                   |                                     | $(DEB_BUILD_GNU_TYPE)  |
| --mandir            |                               |   |                                   |                                     | \$${prefix}/share/man  |
| --infodir           |                               |   |                                   |                                     | \$${prefix}/share/info |
| --ffmpeg            |                               |   |                                   |                                     | /usr                   |
|                     |                               |   | ZM_RUNDIR /var/run/zm             |                                     |                        |
|                     |                               |   | ZM_TMPDIR /tmp/zm                 |                                     |                        |
|                     |                               |   | ZM_LOGDIR /var/log/zm             |                                     |                        |
|                     |                               |   | ZM_WEBDIR                         | <prefix>/share/zoneminder/www       |                        |
|                     | /var/cache/zoneminder         | X | ZM_CONTENTDIR (events and images) | /var/lib/zoneminder                 |                        |
|                     |                               |   | ZM_DB_HOST localhost              |                                     |                        |
|                     |                               |   | ZM_DB_NAME zm                     |                                     |                        |
|                     |                               |   | ZM_DB_USER zmuser                 |                                     |                        |
|                     |                               |   | ZM_DB_PASS zmpass                 |                                     |                        |
|                     |                               |   | ZM_WEB_GROUP                      |                                     |                        |

*** BUILD chunk
   #+NAME: BUILD
   #+BEGIN_SRC sh
          build() {
              cd $srcdir/ZoneMinder-$pkgver

              cmake -DCMAKE_INSTALL_PREFIX=/usr \
                  -DZM_CGIDIR=/srv/http/cgi-bin \
                  -DZM_WEBDIR=/srv/http/zoneminder \
                  -DZM_WEB_USER=http \
                  -DZM_CONTENTDIR=/var/cache/zoneminder \
                  -DZM_LOGDIR=/var/log/zoneminder \
                  -DZM_RUNDIR=/var/run/zm
              make V=0
          }
   #+END_SRC
   
*** BUILD-GIT chunk
   #+NAME: BUILD-GIT
   #+BEGIN_SRC sh
          build() {
              cd $srcdir/$pkgname

              cmake -DCMAKE_INSTALL_PREFIX=/usr \
                  -DZM_CGIDIR=/srv/http/cgi-bin \
                  -DZM_WEBDIR=/srv/http/zoneminder \
                  -DZM_WEB_USER=http \
                  -DZM_CONTENTDIR=/var/cache/zoneminder \
                  -DZM_LOGDIR=/var/log/zoneminder \
                  -DZM_RUNDIR=/var/run/zm
              make V=0
          }
   #+END_SRC
   
** PACKAGE
*** PACKAGE chunk
    #+NAME: PACKAGE
    #+BEGIN_SRC sh
      package() {

          cd $srcdir/ZoneMinder-$pkgver

          DESTDIR=$pkgdir make install

          <<CREATE_ZONEMINDER_DIRECTORIES>>

          <<CREATE_AND_LINK_CONTENT_FOLDERS>>

          <<CREATE_CGI_BIN_LINK>>

          <<CHANGE_OWNER_AND_GROUP>>

          <<LINK_CAMBOZOLA>>

          <<INSTALL_CONF_FILES>>

      }

    #+END_SRC

**** CREATE_ZONEMINDER_DIRECTORIES chunk
     #+NAME: CREATE_ZONEMINDER_DIRECTORIES
     #+BEGIN_SRC sh 
       # BEGIN CREATE_ZONEMINDER_DIRECTORIES
       mkdir -p $pkgdir/var/run/zm
       chown -v http.http $pkgdir/var/run/zm
       mkdir -p $pkgdir/var/{cache/$pkgbase,log/$pkgbase}
       mkdir -p $pkgdir/srv/zoneminder/socks
       chown -Rv http.http $pkgdir/{etc/zm.conf,var/{cache/$pkgbase,log/$pkgbase}}
       chown -Rv http.http $pkgdir/srv/zoneminder/socks
       chmod 0700 $pkgdir/etc/zm.conf
       # END CREATE_ZONEMINDER_DIRECTORIES
     #+END_SRC
     #+TBLNAME: result of original mkdir
     | /srv                    |
     | /srv/http               |
     | /srv/http/cgi-bin       |
     | /etc                    |
     | /etc/rc.d               |
     | /etc/httpd              |
     | /etc/httpd/conf         |
     | /etc/httpd/conf/extra   |
     | /usr                    |
     | /usr/share              |
     | /usr/share/db           |
     | /usr/share/license      |
     | /usr/lib                |
     | /usr/lib/systemd        |
     | /usr/lib/systemd/system |
     | /var                    |
     | /var/cache              |
     | /var/log                |
***** Change Log
****** mkdir (2014-09-19)
       removed
       #+BEGIN_SRC sh
         mkdir -p $pkgdir/{etc/{httpd/conf/extra,rc.d},srv/http/{cgi-bin,$pkgbase},usr/{lib/systemd/system,share/{license/$pkgbase,$pkgbase/db}},var/{cache/$pkgbase,log/$pkgbase}}
       #+END_SRC
       and replaced with
       #+BEGIN_SRC sh
         mkdir -p $pkgdir/var/{cache/$pkgbase,log/$pkgbase}
       #+END_SRC
**** CREATE_AND_LINK_CONTENT_CONTENT_FOLDERS chunk
     #+NAME: CREATE_AND_LINK_CONTENT_FOLDERS
     #+BEGIN_SRC sh
       # Make content directories in /var/cache/zoneminder and link them
       for i in events images; do
           mkdir $pkgdir/var/cache/$pkgbase/$i
           ln -s /var/cache/$pkgbase/$i         $pkgdir/srv/http/$pkgbase/$i
           chown -v    http.http                $pkgdir/var/cache/$pkgbase/$i
           chown -v -h http.http                $pkgdir/srv/http/$pkgbase/$i
       done
     #+END_SRC
**** CREATE_CGI_BIN_LINK
     #+NAME: CREATE_CGI_BIN_LINK
     #+BEGIN_SRC sh
       # Create a link to the Zoneminder cgi binaries
       ln -sv /srv/http/cgi-bin $pkgdir/srv/http/$pkgbase
     #+END_SRC
**** CHANGE_OWNER_AND_GROUP chunk
     #+NAME: CHANGE_OWNER_AND_GROUP
     #+BEGIN_SRC sh
       chown -h http.http $pkgdir/srv/http/{cgi-bin,$pkgbase,$pkgbase/cgi-bin}
     #+END_SRC
**** LINK_CAMBOZOLA chunk
     #+NAME: LINK_CAMBOZOLA
     #+BEGIN_SRC sh
       # Link Cambozola
       ln -s /usr/share/cambozola/cambozola.jar $pkgdir/srv/http/$pkgbase
     #+END_SRC
**** INSTALL_CONF_FILES chunk
     #+NAME: INSTALL_CONF_FILES
     #+BEGIN_SRC sh
       # Install configuration files
       mkdir -p $pkgdir/etc/httpd/conf/extra
       install -D -m 644 $srcdir/httpd-$pkgbase.conf $pkgdir/etc/httpd/conf/extra
       mkdir -p $pkgdir/usr/lib/systemd/system
       install -D -m 644 $srcdir/$pkgbase.service    $pkgdir/usr/lib/systemd/system
       install -D -m 644 COPYING                     $pkgdir/usr/share/license/$pkgbase
       install -D -m 644 db/zm*.sql                  $pkgdir/usr/share/$pkgbase/db     
     #+END_SRC
     
*** PACKAGE-GIT chunk
    #+NAME: PACKAGE-GIT
    #+BEGIN_SRC sh
      package() {

          cd $srcdir/$pkgname

          DESTDIR=$pkgdir make install

          <<CREATE_ZONEMINDER_DIRECTORIES>>

          <<CREATE_AND_LINK_CONTENT_FOLDERS>>

          <<CREATE_CGI_BIN_LINK>>

          <<CHANGE_OWNER_AND_GROUP>>

          <<LINK_CAMBOZOLA>>

          <<INSTALL_CONF_FILES>>

      }

    #+END_SRC
*** ERROR TABLE
|      |      | ERROR                                                                                                                    | FIX                                                             |
|------+------+--------------------------------------------------------------------------------------------------------------------------+-----------------------------------------------------------------|
| 0919 | 1105 | mv: cannot stat ‘/home/troy/rcs/zoneminder-aur/FRI/pkg/zoneminder/srv/http/zoneminder/events’: No such file or directory | # mv $pkgdir/srv/http/$pkgbase/$i $pkgdir/var/cache/$pkgbase/$i |
*** Development Log
|      |      |                                                                                                                                                                                                        |
|------+------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 0919 | 1113 | test and document           mkdir -p $pkgdir/{etc/{httpd/conf/extra,rc.d},srv/http/{cgi-bin,$pkgbase},usr/{lib/systemd/system,share/{license/$pkgbase,$pkgbase/db}},var/{cache/$pkgbase,log/$pkgbase}} |
|      |      |                                                                                                                                                                                                        |
*** Test and Document
**** mkdir -p
     #+BEGIN_SRC sh :tangle ./tmp/mkdir01.sh :shebang #!/bin/bash
       export pkgdir=foo
       mkdir -p $pkgdir/{etc/{httpd/conf/extra,rc.d},srv/http/{cgi-bin,$pkgbase},usr/{lib/systemd/system,share/{license/$pkgbase,$pkgbase/db}},var/{cache/$pkgbase,log/$pkgbase}}
     #+END_SRC

** SED Transformations
*** HTTPD.CONF.SED
    #+NAME: HTTPD.CONF.SED
    #+BEGIN_SRC conf :padline no
      <<MOD_MPM_PREFORK.SED>>
      
      <<MOD_CGI.SED>>
      
      <<LIBPHP5.SED>>
      
      <<HTTPD-ZONEMINDER.CONF.SED>>    
    #+END_SRC
*** PHP.INI.SED
    #+NAME: PHP.INI.SED
    #+BEGIN_SRC sh
      # Enable these libraries by removing the leading comment character
      \|^;extension=mysql.so$| s|^;||;
      \|^;extension=mysqli.so$| s|^;||;
      \|^;extension=pdo_mysql.so$| s|^;||;
      \|^;extension=gd.so$| s|^;||;
      \|^;extension=gettext.so$| s|^;||;
      \|^;extension=mcrypt.so$| s|^;||;
      \|^;extension=session.so$| s|^;||;
      \|^;extension=sockets.so$| s|^;||;
      \|^;extension=openssl.so$| s|^;||;
      \|^;extension=ftp.so$| s|^;||;
      \|^;extension=zip.so$| s|^;||;

      # Add zoneminder paths to open_basedir
      s|^open_basedir = /srv/http/:/home/:/tmp/:/usr/share/pear/:/usr/share/webapps/$|&:/etc:/srv/http/zoneminder/:/var/cache/zoneminder/|;
    #+END_SRC
**** MOD_MPM_PREFORK.SED
     #+NAME: MOD_MPM_PREFORK.SED
     #+BEGIN_SRC conf
       # Use mod_mpm_prefork instead of mod_mpm_event.so (FS#39218).
       s|^LoadModule mpm_event_module modules/mod_mpm_event.so$|#&\nLoadModule mpm_prefork_module modules/mod_mpm_prefork.so|;
     #+END_SRC
**** MOD_CGI.SED
     #+NAME: MOD_CGI.SED
     #+BEGIN_SRC conf
       # Zoneminder requires cgi
       \|^#LoadModule cgi_module modules/mod_cgi.so$| s|#||;
     #+END_SRC
**** LIBPHP5.SED
     #+NAME: LIBPHP5.SED
     #+BEGIN_SRC conf
       # libphp5
       \|^LoadModule php5_module modules/libphp5.so$|d;
       s|^#*LoadModule rewrite_module modules/mod_rewrite.so$|&\nLoadModule php5_module modules/libphp5.so|;
       \|^Include /etc/httpd/conf/extra/php5_module.conf|d;
       s|^Include conf/extra/httpd-default.conf$|&\nInclude /etc/httpd/conf/extra/php5_module.conf|;
     #+END_SRC
**** HTTPD-ZONEMINDER.CONF.SED
     #+NAME: HTTPD-ZONEMINDER.CONF.SED
     #+BEGIN_SRC conf
       # Include httpd-zoneminder.conf
       \|^Include /etc/httpd/conf/extra/httpd-zoneminder.conf$|d;
       s|^# Server-pool management (MPM specific)$|\nInclude /etc/httpd/conf/extra/httpd-zoneminder.conf\n&|;
     #+END_SRC

* PKGBUILD							   :noexport:
** TANGLE zoneminder/PKGBUILD
   
   #+BEGIN_SRC sh :tangle zoneminder/PKGBUILD :noweb yes :padline no
          <<CONTRIBUTORS>>
          # Orginally based on a Debian Squeeze package
     
          <<PACKAGE_VERSION_DATA>>
     
          backup=( etc/zm.conf )
          url="https://github.com/ZoneMinder/ZoneMinder/releases"
          license=( GPL )
     
          <<DEPENDENCIES>>
     
          install=$pkgbase.install
     
          <<SOURCES>>
     
          <<BUILD>>
     
          <<PACKAGE>>
   #+END_SRC
** TANGLE httpd-zoneminder.conf
   #+BEGIN_SRC conf :tangle zoneminder/httpd-zoneminder.conf :padline no :noweb yes
     <<httpd-zoneminder.conf>>
   #+END_SRC
** TANGLE zoneminder.service
   #+BEGIN_SRC sh :tangle zoneminder/zoneminder.service :padline no :noweb yes
     <<zoneminder.service>>
   #+END_SRC
** TANGLE zoneminder.install
   #+BEGIN_SRC sh :tangle zoneminder/zoneminder.install :padline no :noweb yes
     <<zoneminder.install>>
   #+END_SRC
** TANGLE php.ini.sed
   #+BEGIN_SRC sh :tangle zoneminder/php.ini.sed :padline no :noweb yes
     <<PHP.INI.SED>>
   #+END_SRC
** TANGLE httpd.conf.sed
   #+BEGIN_SRC sh :tangle zoneminder/httpd.conf.sed :padline no :noweb yes
     <<HTTPD.CONF.SED>>
   #+END_SRC
**** TODO
     1. fix /tmp/zoneminder
     2. 

* GIT PKGBUILD 							   :noexport:
** TANGLE zoneminder-git/PKGBUILD
   
   #+BEGIN_SRC sh :tangle zoneminder-git/PKGBUILD :noweb yes :padline no
          <<CONTRIBUTORS>>
          # Orginally based on a Debian Squeeze package
     
          <<PACKAGE_VERSION_DATA>>
     
          backup=( etc/zm.conf )
          url="https://github.com/ZoneMinder/ZoneMinder/releases"
          license=( GPL )
     
          <<DEPENDENCIES>>
     
          install=$pkgbase.install
     
          <<SOURCES-GIT>>
     
          <<pkgver-git>>

          <<BUILD-GIT>>
     
          <<PACKAGE-GIT>>
   #+END_SRC
** TANGLE httpd-zoneminder.conf
   #+BEGIN_SRC conf :tangle zoneminder-git/httpd-zoneminder.conf :padline no :noweb yes
     <<httpd-zoneminder.conf>>
   #+END_SRC
** TANGLE zoneminder.service
   #+BEGIN_SRC sh :tangle zoneminder-git/zoneminder.service :padline no :noweb yes
     <<zoneminder.service>>
   #+END_SRC
** TANGLE zoneminder.install
   #+BEGIN_SRC sh :tangle zoneminder-git/zoneminder.install :padline no :noweb yes
     <<zoneminder.install>>
   #+END_SRC
** TANGLE php.ini.sed
   #+BEGIN_SRC sh :tangle zoneminder-git/php.ini.sed :padline no :noweb yes
     <<PHP.INI.SED>>
   #+END_SRC
** TANGLE httpd.conf.sed
   #+BEGIN_SRC sh :tangle zoneminder-git/httpd.conf.sed :padline no :noweb yes
     <<HTTPD.CONF.SED>>
   #+END_SRC
**** TODO
     1. fix /tmp/zoneminder
     2. 

* HOW TO UPLOAD PKGBUILD TO AUR
  1. [ ] run mkaurball
  2. Read [[https://wiki.archlinux.org/index.php/Arch_User_Repository#Sharing_and_maintaining_packages][Sharing and maintaining packages]]
  3. [ ] [[https://aur.archlinux.org/][Log In]]
  4. [ ] [[https://aur.archlinux.org/submit/][Submit]]
* PRIMARY DOCUMENTATION						   :noexport:
* DEBUGGING
**   
|        Time | Component |  PID | Level | Message                                                                                                                                 | File                              | Line |
|-------------+-----------+------+-------+-----------------------------------------------------------------------------------------------------------------------------------------+-----------------------------------+------|
| 00:15:18.70 | web_js    | 3770 | ERR   | getStreamCmdResponse stream error: socket_sendto( /tmp/zm/zms-311647s.sock ) failed: No such file or directory - checkStreamForErrors() | ?view=watch                       |      |
| 00:15:18.60 | web_php   | 3770 | ERR   | socket_sendto( /tmp/zm/zms-311647s.sock ) failed: No such file or directory                                                             | zoneminder/includes/functions.php | 2337 |

* TODO sed script development and documentation
  #+BEGIN_SRC conf :tangle ./devel/postinstall/httpd.conf :padline no
    #
    # This is the main Apache HTTP server configuration file.  It contains the
    # configuration directives that give the server its instructions.
    # See <URL:http://httpd.apache.org/docs/2.4/> for detailed information.
    # In particular, see 
    # <URL:http://httpd.apache.org/docs/2.4/mod/directives.html>
    # for a discussion of each configuration directive.
    #
    # Do NOT simply read the instructions in here without understanding
    # what they do.  They're here only as hints or reminders.  If you are unsure
    # consult the online docs. You have been warned.  
    #
    # Configuration and logfile names: If the filenames you specify for many
    # of the server's control files begin with "/" (or "drive:/" for Win32), the
    # server will use that explicit path.  If the filenames do *not* begin
    # with "/", the value of ServerRoot is prepended -- so "logs/access_log"
    # with ServerRoot set to "/usr/local/apache2" will be interpreted by the
    # server as "/usr/local/apache2/logs/access_log", whereas "/logs/access_log" 
    # will be interpreted as '/logs/access_log'.

    #
    # ServerRoot: The top of the directory tree under which the server's
    # configuration, error, and log files are kept.
    #
    # Do not add a slash at the end of the directory path.  If you point
    # ServerRoot at a non-local disk, be sure to specify a local disk on the
    # Mutex directive, if file-based mutexes are used.  If you wish to share the
    # same ServerRoot for multiple httpd daemons, you will need to change at
    # least PidFile.
    #
    ServerRoot "/etc/httpd"

    #
    # Mutex: Allows you to set the mutex mechanism and mutex file directory
    # for individual mutexes, or change the global defaults
    #
    # Uncomment and change the directory if mutexes are file-based and the default
    # mutex file directory is not on a local disk or is not appropriate for some
    # other reason.
    #
    # Mutex default:/run/httpd

    #
    # Listen: Allows you to bind Apache to specific IP addresses and/or
    # ports, instead of the default. See also the <VirtualHost>
    # directive.
    #
    # Change this to Listen on specific IP addresses as shown below to 
    # prevent Apache from glomming onto all bound IP addresses.
    #
    #Listen 12.34.56.78:80
    Listen 80

    #
    # Dynamic Shared Object (DSO) Support
    #
    # To be able to use the functionality of a module which was built as a DSO you
    # have to place corresponding `LoadModule' lines at this location so the
    # directives contained in it are actually available _before_ they are used.
    # Statically compiled modules (those listed by `httpd -l') do not need
    # to be loaded here.
    #
    # Example:
    # LoadModule foo_module modules/mod_foo.so
    #
    LoadModule authn_file_module modules/mod_authn_file.so
    #LoadModule authn_dbm_module modules/mod_authn_dbm.so
    #LoadModule authn_anon_module modules/mod_authn_anon.so
    #LoadModule authn_dbd_module modules/mod_authn_dbd.so
    #LoadModule authn_socache_module modules/mod_authn_socache.so
    LoadModule authn_core_module modules/mod_authn_core.so
    LoadModule authz_host_module modules/mod_authz_host.so
    LoadModule authz_groupfile_module modules/mod_authz_groupfile.so
    LoadModule authz_user_module modules/mod_authz_user.so
    #LoadModule authz_dbm_module modules/mod_authz_dbm.so
    #LoadModule authz_owner_module modules/mod_authz_owner.so
    #LoadModule authz_dbd_module modules/mod_authz_dbd.so
    LoadModule authz_core_module modules/mod_authz_core.so
    #LoadModule authnz_ldap_module modules/mod_authnz_ldap.so
    LoadModule access_compat_module modules/mod_access_compat.so
    LoadModule auth_basic_module modules/mod_auth_basic.so
    #LoadModule auth_form_module modules/mod_auth_form.so
    #LoadModule auth_digest_module modules/mod_auth_digest.so
    #LoadModule allowmethods_module modules/mod_allowmethods.so
    #LoadModule file_cache_module modules/mod_file_cache.so
    #LoadModule cache_module modules/mod_cache.so
    #LoadModule cache_disk_module modules/mod_cache_disk.so
    #LoadModule cache_socache_module modules/mod_cache_socache.so
    #LoadModule socache_shmcb_module modules/mod_socache_shmcb.so
    #LoadModule socache_dbm_module modules/mod_socache_dbm.so
    #LoadModule socache_memcache_module modules/mod_socache_memcache.so
    #LoadModule watchdog_module modules/mod_watchdog.so
    #LoadModule macro_module modules/mod_macro.so
    #LoadModule dbd_module modules/mod_dbd.so
    #LoadModule dumpio_module modules/mod_dumpio.so
    #LoadModule echo_module modules/mod_echo.so
    #LoadModule buffer_module modules/mod_buffer.so
    #LoadModule data_module modules/mod_data.so
    #LoadModule ratelimit_module modules/mod_ratelimit.so
    LoadModule reqtimeout_module modules/mod_reqtimeout.so
    #LoadModule ext_filter_module modules/mod_ext_filter.so
    #LoadModule request_module modules/mod_request.so
    LoadModule include_module modules/mod_include.so
    LoadModule filter_module modules/mod_filter.so
    #LoadModule reflector_module modules/mod_reflector.so
    #LoadModule substitute_module modules/mod_substitute.so
    #LoadModule sed_module modules/mod_sed.so
    #LoadModule charset_lite_module modules/mod_charset_lite.so
    #LoadModule deflate_module modules/mod_deflate.so
    #LoadModule xml2enc_module modules/mod_xml2enc.so
    #LoadModule proxy_html_module modules/mod_proxy_html.so
    LoadModule mime_module modules/mod_mime.so
    #LoadModule ldap_module modules/mod_ldap.so
    LoadModule log_config_module modules/mod_log_config.so
    #LoadModule log_debug_module modules/mod_log_debug.so
    #LoadModule log_forensic_module modules/mod_log_forensic.so
    #LoadModule logio_module modules/mod_logio.so
    #LoadModule lua_module modules/mod_lua.so
    LoadModule env_module modules/mod_env.so
    #LoadModule mime_magic_module modules/mod_mime_magic.so
    #LoadModule cern_meta_module modules/mod_cern_meta.so
    #LoadModule expires_module modules/mod_expires.so
    LoadModule headers_module modules/mod_headers.so
    #LoadModule ident_module modules/mod_ident.so
    #LoadModule usertrack_module modules/mod_usertrack.so
    #LoadModule unique_id_module modules/mod_unique_id.so
    LoadModule setenvif_module modules/mod_setenvif.so
    LoadModule version_module modules/mod_version.so
    #LoadModule remoteip_module modules/mod_remoteip.so
    LoadModule proxy_module modules/mod_proxy.so
    LoadModule proxy_connect_module modules/mod_proxy_connect.so
    LoadModule proxy_ftp_module modules/mod_proxy_ftp.so
    LoadModule proxy_http_module modules/mod_proxy_http.so
    LoadModule proxy_fcgi_module modules/mod_proxy_fcgi.so
    LoadModule proxy_scgi_module modules/mod_proxy_scgi.so
    #LoadModule proxy_fdpass_module modules/mod_proxy_fdpass.so
    LoadModule proxy_wstunnel_module modules/mod_proxy_wstunnel.so
    LoadModule proxy_ajp_module modules/mod_proxy_ajp.so
    LoadModule proxy_balancer_module modules/mod_proxy_balancer.so
    LoadModule proxy_express_module modules/mod_proxy_express.so
    #LoadModule session_module modules/mod_session.so
    #LoadModule session_cookie_module modules/mod_session_cookie.so
    #LoadModule session_crypto_module modules/mod_session_crypto.so
    #LoadModule session_dbd_module modules/mod_session_dbd.so
    LoadModule slotmem_shm_module modules/mod_slotmem_shm.so
    #LoadModule slotmem_plain_module modules/mod_slotmem_plain.so
    #LoadModule ssl_module modules/mod_ssl.so
    #LoadModule dialup_module modules/mod_dialup.so
    LoadModule lbmethod_byrequests_module modules/mod_lbmethod_byrequests.so
    LoadModule lbmethod_bytraffic_module modules/mod_lbmethod_bytraffic.so
    LoadModule lbmethod_bybusyness_module modules/mod_lbmethod_bybusyness.so
    LoadModule lbmethod_heartbeat_module modules/mod_lbmethod_heartbeat.so
    LoadModule mpm_event_module modules/mod_mpm_event.so
    LoadModule unixd_module modules/mod_unixd.so
    #LoadModule heartbeat_module modules/mod_heartbeat.so
    #LoadModule heartmonitor_module modules/mod_heartmonitor.so
    #LoadModule dav_module modules/mod_dav.so
    LoadModule status_module modules/mod_status.so
    LoadModule autoindex_module modules/mod_autoindex.so
    #LoadModule asis_module modules/mod_asis.so
    #LoadModule info_module modules/mod_info.so
    #LoadModule suexec_module modules/mod_suexec.so
    #LoadModule cgid_module modules/mod_cgid.so
    #LoadModule cgi_module modules/mod_cgi.so
    #LoadModule dav_fs_module modules/mod_dav_fs.so
    #LoadModule dav_lock_module modules/mod_dav_lock.so
    #LoadModule vhost_alias_module modules/mod_vhost_alias.so
    LoadModule negotiation_module modules/mod_negotiation.so
    LoadModule dir_module modules/mod_dir.so
    #LoadModule imagemap_module modules/mod_imagemap.so
    #LoadModule actions_module modules/mod_actions.so
    #LoadModule speling_module modules/mod_speling.so
    LoadModule userdir_module modules/mod_userdir.so
    LoadModule alias_module modules/mod_alias.so
    #LoadModule rewrite_module modules/mod_rewrite.so

    <IfModule unixd_module>
    #
    # If you wish httpd to run as a different user or group, you must run
    # httpd as root initially and it will switch.  
    #
    # User/Group: The name (or #number) of the user/group to run httpd as.
    # It is usually good practice to create a dedicated user and group for
    # running httpd, as with most system services.
    #
    User http
    Group http

    </IfModule>

    # 'Main' server configuration
    #
    # The directives in this section set up the values used by the 'main'
    # server, which responds to any requests that aren't handled by a
    # <VirtualHost> definition.  These values also provide defaults for
    # any <VirtualHost> containers you may define later in the file.
    #
    # All of these directives may appear inside <VirtualHost> containers,
    # in which case these default settings will be overridden for the
    # virtual host being defined.
    #

    #
    # ServerAdmin: Your address, where problems with the server should be
    # e-mailed.  This address appears on some server-generated pages, such
    # as error documents.  e.g. admin@your-domain.com
    #
    ServerAdmin you@example.com

    #
    # ServerName gives the name and port that the server uses to identify itself.
    # This can often be determined automatically, but we recommend you specify
    # it explicitly to prevent problems during startup.
    #
    # If your host doesn't have a registered DNS name, enter its IP address here.
    #
    #ServerName www.example.com:80

    #
    # Deny access to the entirety of your server's filesystem. You must
    # explicitly permit access to web content directories in other 
    # <Directory> blocks below.
    #
    <Directory />
        AllowOverride none
        Require all denied
    </Directory>

    #
    # Note that from this point forward you must specifically allow
    # particular features to be enabled - so if something's not working as
    # you might expect, make sure that you have specifically enabled it
    # below.
    #

    #
    # DocumentRoot: The directory out of which you will serve your
    # documents. By default, all requests are taken from this directory, but
    # symbolic links and aliases may be used to point to other locations.
    #
    DocumentRoot "/srv/http"
    <Directory "/srv/http">
        #
        # Possible values for the Options directive are "None", "All",
        # or any combination of:
        #   Indexes Includes FollowSymLinks SymLinksifOwnerMatch ExecCGI MultiViews
        #
        # Note that "MultiViews" must be named *explicitly* --- "Options All"
        # doesn't give it to you.
        #
        # The Options directive is both complicated and important.  Please see
        # http://httpd.apache.org/docs/2.4/mod/core.html#options
        # for more information.
        #
        Options Indexes FollowSymLinks

        #
        # AllowOverride controls what directives may be placed in .htaccess files.
        # It can be "All", "None", or any combination of the keywords:
        #   AllowOverride FileInfo AuthConfig Limit
        #
        AllowOverride None

        #
        # Controls who can get stuff from this server.
        #
        Require all granted
    </Directory>

    #
    # DirectoryIndex: sets the file that Apache will serve if a directory
    # is requested.
    #
    <IfModule dir_module>
        DirectoryIndex index.html
    </IfModule>

    #
    # The following lines prevent .htaccess and .htpasswd files from being 
    # viewed by Web clients. 
    #
    <Files ".ht*">
        Require all denied
    </Files>

    #
    # ErrorLog: The location of the error log file.
    # If you do not specify an ErrorLog directive within a <VirtualHost>
    # container, error messages relating to that virtual host will be
    # logged here.  If you *do* define an error logfile for a <VirtualHost>
    # container, that host's errors will be logged there and not here.
    #
    ErrorLog "/var/log/httpd/error_log"

    #
    # LogLevel: Control the number of messages logged to the error_log.
    # Possible values include: debug, info, notice, warn, error, crit,
    # alert, emerg.
    #
    LogLevel warn

    <IfModule log_config_module>
        #
        # The following directives define some format nicknames for use with
        # a CustomLog directive (see below).
        #
        LogFormat "%h %l %u %t \"%r\" %>s %b \"%{Referer}i\" \"%{User-Agent}i\"" combined
        LogFormat "%h %l %u %t \"%r\" %>s %b" common

        <IfModule logio_module>
          # You need to enable mod_logio.c to use %I and %O
          LogFormat "%h %l %u %t \"%r\" %>s %b \"%{Referer}i\" \"%{User-Agent}i\" %I %O" combinedio
        </IfModule>

        #
        # The location and format of the access logfile (Common Logfile Format).
        # If you do not define any access logfiles within a <VirtualHost>
        # container, they will be logged here.  Contrariwise, if you *do*
        # define per-<VirtualHost> access logfiles, transactions will be
        # logged therein and *not* in this file.
        #
        CustomLog "/var/log/httpd/access_log" common

        #
        # If you prefer a logfile with access, agent, and referer information
        # (Combined Logfile Format) you can use the following directive.
        #
        #CustomLog "/var/log/httpd/access_log" combined
    </IfModule>

    <IfModule alias_module>
        #
        # Redirect: Allows you to tell clients about documents that used to 
        # exist in your server's namespace, but do not anymore. The client 
        # will make a new request for the document at its new location.
        # Example:
        # Redirect permanent /foo http://www.example.com/bar

        #
        # Alias: Maps web paths into filesystem paths and is used to
        # access content that does not live under the DocumentRoot.
        # Example:
        # Alias /webpath /full/filesystem/path
        #
        # If you include a trailing / on /webpath then the server will
        # require it to be present in the URL.  You will also likely
        # need to provide a <Directory> section to allow access to
        # the filesystem path.

        #
        # ScriptAlias: This controls which directories contain server scripts. 
        # ScriptAliases are essentially the same as Aliases, except that
        # documents in the target directory are treated as applications and
        # run by the server when requested rather than as documents sent to the
        # client.  The same rules about trailing "/" apply to ScriptAlias
        # directives as to Alias.
        #
        ScriptAlias /cgi-bin/ "/srv/http/cgi-bin/"

    </IfModule>

    <IfModule cgid_module>
        #
        # ScriptSock: On threaded servers, designate the path to the UNIX
        # socket used to communicate with the CGI daemon of mod_cgid.
        #
        #Scriptsock cgisock
    </IfModule>

    #
    # "/srv/http/cgi-bin" should be changed to whatever your ScriptAliased
    # CGI directory exists, if you have that configured.
    #
    <Directory "/srv/http/cgi-bin">
        AllowOverride None
        Options None
        Require all granted
    </Directory>

    <IfModule mime_module>
        #
        # TypesConfig points to the file containing the list of mappings from
        # filename extension to MIME-type.
        #
        TypesConfig conf/mime.types

        #
        # AddType allows you to add to or override the MIME configuration
        # file specified in TypesConfig for specific file types.
        #
        #AddType application/x-gzip .tgz
        #
        # AddEncoding allows you to have certain browsers uncompress
        # information on the fly. Note: Not all browsers support this.
        #
        #AddEncoding x-compress .Z
        #AddEncoding x-gzip .gz .tgz
        #
        # If the AddEncoding directives above are commented-out, then you
        # probably should define those extensions to indicate media types:
        #
        AddType application/x-compress .Z
        AddType application/x-gzip .gz .tgz

        #
        # AddHandler allows you to map certain file extensions to "handlers":
        # actions unrelated to filetype. These can be either built into the server
        # or added with the Action directive (see below)
        #
        # To use CGI scripts outside of ScriptAliased directories:
        # (You will also need to add "ExecCGI" to the "Options" directive.)
        #
        #AddHandler cgi-script .cgi

        # For type maps (negotiated resources):
        #AddHandler type-map var

        #
        # Filters allow you to process content before it is sent to the client.
        #
        # To parse .shtml files for server-side includes (SSI):
        # (You will also need to add "Includes" to the "Options" directive.)
        #
        #AddType text/html .shtml
        #AddOutputFilter INCLUDES .shtml
    </IfModule>

    #
    # The mod_mime_magic module allows the server to use various hints from the
    # contents of the file itself to determine its type.  The MIMEMagicFile
    # directive tells the module where the hint definitions are located.
    #
    #MIMEMagicFile conf/magic

    #
    # Customizable error responses come in three flavors:
    # 1) plain text 2) local redirects 3) external redirects
    #
    # Some examples:
    #ErrorDocument 500 "The server made a boo boo."
    #ErrorDocument 404 /missing.html
    #ErrorDocument 404 "/cgi-bin/missing_handler.pl"
    #ErrorDocument 402 http://www.example.com/subscription_info.html
    #

    #
    # MaxRanges: Maximum number of Ranges in a request before
    # returning the entire resource, or one of the special
    # values 'default', 'none' or 'unlimited'.
    # Default setting is to accept 200 Ranges.
    #MaxRanges unlimited

    #
    # EnableMMAP and EnableSendfile: On systems that support it, 
    # memory-mapping or the sendfile syscall may be used to deliver
    # files.  This usually improves server performance, but must
    # be turned off when serving from networked-mounted 
    # filesystems or if support for these functions is otherwise
    # broken on your system.
    # Defaults: EnableMMAP On, EnableSendfile Off
    #
    #EnableMMAP off
    #EnableSendfile on

    # Supplemental configuration
    #
    # The configuration files in the conf/extra/ directory can be 
    # included to add extra features or to modify the default configuration of 
    # the server, or you may simply copy their contents here and change as 
    # necessary.

    # Server-pool management (MPM specific)
    Include conf/extra/httpd-mpm.conf

    # Multi-language error messages
    Include conf/extra/httpd-multilang-errordoc.conf

    # Fancy directory listings
    Include conf/extra/httpd-autoindex.conf

    # Language settings
    Include conf/extra/httpd-languages.conf

    # User home directories
    Include conf/extra/httpd-userdir.conf

    # Real-time info on requests and configuration
    #Include conf/extra/httpd-info.conf

    # Virtual hosts
    #Include conf/extra/httpd-vhosts.conf

    # Local access to the Apache HTTP Server Manual
    #Include conf/extra/httpd-manual.conf

    # Distributed authoring and versioning (WebDAV)
    #Include conf/extra/httpd-dav.conf

    # Various default settings
    Include conf/extra/httpd-default.conf

    # Configure mod_proxy_html to understand HTML4/XHTML1
    <IfModule proxy_html_module>
    Include conf/extra/proxy-html.conf
    </IfModule>

    # Secure (SSL/TLS) connections
    #Include conf/extra/httpd-ssl.conf
    #
    # Note: The following must must be present to support
    #       starting without SSL on platforms with no /dev/random equivalent
    #       but a statically compiled-in mod_ssl.
    #
    <IfModule ssl_module>
    SSLRandomSeed startup builtin
    SSLRandomSeed connect builtin
    </IfModule>
    #
    # uncomment out the below to deal with user agents that deliberately
    # violate open standards by misusing DNT (DNT *must* be a specific
    # end-user choice)
    #
    #<IfModule setenvif_module>
    #BrowserMatch "MSIE 10.0;" bad_DNT
    #</IfModule>
    #<IfModule headers_module>
    #RequestHeader unset DNT env=bad_DNT
    #</IfModule>


  #+END_SRC
* TODO https://github.com/ZoneMinder/ZoneMinder/issues/88
* TODO TESTING
* TODO OTHER DISTROS
* TDW								   :noexport:
  1. makepkg --geninteg >> PKGBUILD
  2. makepkg --syncdeps
** CMAKE
*** Config Table
| ./configure         | Arch Linux                    | Debian Sid             | CMAKE                                                                                     |
|---------------------+-------------------------------+------------------------+-------------------------------------------------------------------------------------------|
| --prefix            | /usr                          | /usr                   | CMAKE_INSTALL_PREFIX                                                                      |
| --enable-crashtrace | no                            | no                     |                                                                                           |
| --enable-debug      | no                            |                        |                                                                                           |
| --enable-mmap       | yes                           | yes                    | ZM_NO_MMAP default: OFF                                                                   |
| --sysconfdir        | /etc                          | /etc/zm                |                                                                                           |
| --with-cgidir       | /srv/http/cgi-bin             | /usr/lib/cgi-bin       | ZM_CGIDIR <prefix>/libexec/zoneminder/cgi-bin => /var/run/zm/                             |
| --with-extralibs    | '-L/usr/lib -L/usr/lib/mysql' |                        | CMAKE_LIBRARY_PATH                                                                        |
| --with-libarch      | lib                           |                        |                                                                                           |
| --with-ffmpeg       | /usr                          |                        |                                                                                           |
| --with-mysql        | /usr                          | /usr                   |                                                                                           |
| --with-webdir       | /srv/http/$pkgbase            | /usr/share/zoneminder  | ZM_WEBDIR default: usr/share/zoneminder/www => /srv/http/$pkgbase                         |
| --with-webgroup     | http                          | www-data               |                                                                                           |
| --with-webhost      | localhost                     |                        |                                                                                           |
| --with-webuser      | http                          | www-data               | ZM_WEB_USER The user apache runs on. Leave empty for automatic detection.                 |
| --host              |                               | $(DEB_HOST_GNU_TYPE)   |                                                                                           |
| --build             |                               | $(DEB_BUILD_GNU_TYPE)  |                                                                                           |
| --mandir            |                               | \$${prefix}/share/man  |                                                                                           |
| --infodir           |                               | \$${prefix}/share/info |                                                                                           |
| --ffmpeg            |                               | /usr                   |                                                                                           |
|                     |                               |                        | ZM_RUNDIR /var/run/zm                                                                     |
|                     |                               |                        | ZM_TMPDIR /tmp/zm                                                                         |
|                     |                               |                        | ZM_LOGDIR /var/log/zm                                                                     |
|                     |                               |                        | ZM_WEBDIR <prefix>/share/zoneminder/www                                                   |
|                     |                               |                        | ZM_CONTENTDIR  (events and images), default: /var/lib/zoneminder => /var/cache/zoneminder |
|                     |                               |                        | ZM_DB_HOST localhost                                                                      |
|                     |                               |                        | ZM_DB_NAME zm                                                                             |
|                     |                               |                        | ZM_DB_USER zmuser                                                                         |
|                     |                               |                        | ZM_DB_PASS zmpass                                                                         |
|                     |                               |                        | ZM_WEB_GROUP          |

Advanced:
			A list of optional libraries, separated by semicolons, e.g. ssl;theora
	ZM_MYSQL_ENGINE		MySQL engine to use with database, default: InnoDB
	ZM_NO_MMAP		Set to ON to not use mmap shared memory. Shouldn't be enabled unless you experience problems with the shared memory. default: OFF
	ZM_NO_FFMPEG		Set to ON to skip ffmpeg checks and force building ZM without ffmpeg. default: OFF
	ZM_NO_X10		Set to ON to build ZoneMinder without X10 support. default: OFF
	ZM_PERL_SUBPREFIX	Use a different directory for the zm perl modules. NOTE: This is a subprefix, e.g. lib will be turned into <prefix>/lib, default: <libarch>/perl5
	ZM_PERL_USE_PATH	Override the include path for zm perl modules. Useful if you are moving the perl modules without using the ZM_PERL_SUBPREFIX option. default: <prefix>/<zmperlsubprefix>
*** INSTALL
    Installing ZoneMinder with cmake
--------------------------------
Configuration
-------------
cmake by default does not require any parameters, but its possible to override the defaults with the options below.

1. As a command line parameter, e.g. cmake -DCMAKE_VERBOSE_MAKEFILE=ON .
   
cmake -DCMAKE_VERBOSE_MAKEFILE=ON -DZM_WEB_USER=http -DZM_CGIDIR=/var/run/zm/ .   

Possible configuration options: 
	ZM_RUNDIR		Location of transient process files, default: /var/run/zm
	ZM_TMPDIR		Location of temporary files, default: /tmp/zm
	ZM_LOGDIR 		Location of generated log files, default: /var/log/zm
	ZM_WEBDIR		Location of the web files, default: <prefix>/share/zoneminder/www
	ZM_CGIDIR		Location of the cgi-bin files, default: <prefix>/libexec/zoneminder/cgi-bin
	ZM_CONTENTDIR		Location of dynamic content (events and images), default: /var/lib/zoneminder
	ZM_DB_HOST		Hostname where ZoneMinder database located, default: localhost
	ZM_DB_NAME		Name of ZoneMinder database, default: zm
	ZM_DB_USER		Name of ZoneMinder database user, default: zmuser
	ZM_DB_PASS		Password of ZoneMinder database user, default: zmpass
	ZM_WEB_USER		The user apache or the local web server runs on. Leave empty for automatic detection. If that fails, you can use this variable to force
	ZM_WEB_GROUP		The group apache or the local web server runs on, Leave empty to be the same as the web user
Advanced:
	ZM_EXTRA_LIBS		A list of optional libraries, separated by semicolons, e.g. ssl;theora
	ZM_MYSQL_ENGINE		MySQL engine to use with database, default: InnoDB
	ZM_NO_MMAP		Set to ON to not use mmap shared memory. Shouldn't be enabled unless you experience problems with the shared memory. default: OFF
	ZM_NO_FFMPEG		Set to ON to skip ffmpeg checks and force building ZM without ffmpeg. default: OFF
	ZM_NO_X10		Set to ON to build ZoneMinder without X10 support. default: OFF
	ZM_PERL_SUBPREFIX	Use a different directory for the zm perl modules. NOTE: This is a subprefix, e.g. lib will be turned into <prefix>/lib, default: <libarch>/perl5
	ZM_PERL_USE_PATH	Override the include path for zm perl modules. Useful if you are moving the perl modules without using the ZM_PERL_SUBPREFIX option. default: <prefix>/<zmperlsubprefix>


Useful configuration options provided by cmake:
CMAKE_VERBOSE_MAKEFILE - Set this to ON (default OFF) to see what cmake is doing. Very useful for troubleshooting.
CMAKE_BUILD_TYPE - Set this to Debug (default Release) to build ZoneMinder with debugging enabled.
CMAKE_INSTALL_PREFIX - Use this to change the prefix (default /usr/local). This option behaves like --prefix from autoconf. Package maintainers will probably want to set this to "/usr".

Useful environment variables provided by cmake:
CMAKE_INCLUDE_PATH - Use this to add to the include search path.
CMAKE_LIBRARY_PATH - Use this to add to the library search path.
CMAKE_PREFIX_PATH - Use this to add to both include and library search paths. <path>/include will be added to the include search path and <path>/lib to the library search path. Multiple paths can be specified, separated by a : character. For example: export CMAKE_PREFIX_PATH="/opt/libjpeg-turbo:/opt/ffmpeg-from-git"

CFLAGS, CPPFLAGS and other environment variables:
To append to the CFLAGS and CXXFLAGS, please use the CFLAGS and CXXFLAGS environment variables.
Or use the CMAKE_C_FLAGS and CMAKE_CXX_FLAGS configuration options.
To replace the CFLAGS and CXXFLAGS entirely:
+   For the Release build type: use CMAKE_C_FLAGS_RELEASE for the CFLAGS and CMAKE_CXX_FLAGS_RELEASE for the CXXFLAGS
+   For the Debug build type: use CMAKE_C_FLAGS_DEBUG for the CFLAGS and CMAKE_CXX_FLAGS_DEBUG for the CXXFLAGS
Other important environment variables (such as LDFLAGS) are also supported.

The DESTDIR environment variable is also supported, however it needs to be set before invoking make install. For example: DESTDIR=mydestdir make install
For more information about DESTDIR, see:
+   http://www.gnu.org/prep/standards/html_node/DESTDIR.html

Basic steps for installing ZoneMinder on a fresh system
-------------------------------------------------------
1) After installing all the required dependencies, in the project directory, run "cmake [extra options] ."
This behaves like ./configure. It is also possible to supply configuration options, e.g. cmake -DZM_DB_PASS="mypass" .
2) Run "make" to compile ZoneMinder
3) Run "make install" (as root, or use sudo) to install ZoneMinder to your system.
4) Create a directory for the content and the necessary symlinks by running zmlinkcontent.sh with the directory you want to use. e.g. ./zmlinkcontent.sh /nfs/zm
5) Create a database for zoneminder, called "zm".
6) Create a user for the zoneminder database, called zmuser with password and full privileges to the "zm" database.
NOTE: The database server, database name, user and password can be different and adjusted during configuration step with the options in this file, or by editing /etc/zm.conf
7) Populate the zoneminder database using the script zm_create.sql. This should be found in <prefix>/share/zoneminder/db or in the project/db directory.

8) Create an apache virtual host for ZoneMinder. Make sure to use the same paths as ZM_WEBDIR and ZM_CGIDIR in /etc/zm.conf
9) Create other config if desired (e.g. rsyslog, logrotate and such). Some of this can be found in <prefix>/share/zoneminder/misc or project/misc directory
10) Setup an init script for your system. Its also possible to use "zmpkg.pl start" and "zmpkg.pl stop" if you can't find a one.

Basic steps for upgrading ZoneMinder
------------------------------------
1) If you wish to use the same paths and configuration as the currently installed ZoneMinder, you need to provide cmake with options that match your current installation.
You can provide those options in the command line to cmake, e.g. cmake -DZM_DB_PASS="blah" -DZM_WEBDIR="/usr/local/share/zoneminder/www" -DCMAKE_INSTALL_FULL_BINDIR="/usr/bin" .
Or alternatively, for convenience, use the cmakecacheimport.sh script. This reads a zoneminder configuration file (zm.conf) and creates a cmake initial cache file called zm_conf.cmake, which you can then provide to cmake.
For example:
./cmakecacheimport.sh /etc/zm.conf
cmake -C zm_conf.cmake [extra options] .

2) Run "make" to compile ZoneMinder
3) Run "make install" (as root, or use sudo) to install ZoneMinder to your system.
4) Depending on your configuration: If the DIR_EVENTS and DIR_IMAGES options are set to default (pointing to web directory/events and web directory/images), You will need to update the symlinks in the web directory to the correct folders. e.g. web directory/events should point to the real events directory, and likewise for the images directory.
You can use the zmlinkcontent.sh script for this. For example, if /var/lib/zoneminder is the folder that contains the "images" and "events" directories, you can use:
./zmlinkcontent.sh /var/lib/zoneminder
By default, the content directory for new installations is /var/lib/zoneminder. This can be overridden in cmake with the ZM_CONTENTDIR option. e.g. cmake -DZM_CONTENTDIR="/some/big/storage/zm" .

5) Run zmupdate.pl to update the database layout to the new version.

Uninstallation:
---------------
By default, cmake does not have an uninstall target, however we have added a one. Simply run make uninstall (or DESTDIR=mydestdir make uninstall if a DESTDIR was used) and it will remove all the files that cmake installed.
It's also possible to do this manually. The file install_manifest.txt contains the list of files installed to the system. This can be used in many ways to delete all files installed by cmake, such as: xargs rm < install_manifest.txt

Contributions:
--------------
Please visit our GitHub at http://github.com/ZoneMinder/ZoneMinder

*** CMAKE
    
*** Git Branch
    
** Debian
   + https://packages.debian.org/unstable/net/zoneminder
   + https://packages.debian.org/wheezy/zoneminder
*** zoneminder_1.26.5-3.debian.tar.xz  zoneminder_1.26.5.orig.tar.gz
*** Step by step
    1. [ ] Go to https://packages.debian.org/source/sid/zoneminder
    2. [ ] Download [[http://ftp.de.debian.org/debian/pool/main/z/zoneminder/zoneminder_1.26.5-3.debian.tar.xz]]
    3. [ ] Unpack and view rules file for configure parameters
* https://wiki.archlinux.org/index.php/Arch_User_Repository	   :noexport:
  1. [ ] run mkaurball
  2. [[https://wiki.archlinux.org/index.php/Arch_User_Repository#Sharing_and_maintaining_packages][Sharing and maintaining packages]]
  3. [ ] 
* https://aur.archlinux.org/packages/zoneminder/		   :noexport:
* PKGBUILD  2014-09-03						   :noexport:
  # Contributor: /dev/rs0                  </dev/rs0@secretco.de.com>
# Contributor: Jacek Burghardt           <jacek@hebe.us>
# Contributor: Vojtech Aschenbrenner     <v@asch.cz>
# Contributor: Jason Gardner             <buhrietoe@gmail.com>
# Contributor: Ross melin                <rdmelin@gmail.com>
# Contributor (Parabola): Márcio Silva   <coadde@lavabit.com>
# Contributor (Parabola): André Silva    <emulatorman@lavabit.com>

# based of debian squeeze package

pkgbase=zoneminder
pkgname=zoneminder
pkgver=1.27.0
pkgrel=1
pkgdesc='Capture, analyse, record and monitor video security cameras'
arch=(
  i686
  x86_64
  mips64el
  arm
)
backup=(
  etc/zm.conf
)
url="https://github.com/ZoneMinder/ZoneMinder/archive/"
license=(
  GPL
)
depends=(
  apache
  cambozola
  gnutls
  mariadb
  perl-archive-zip
  perl-date-manip
  perl-dbd-mysql
  perl-dbi
  perl-expect
  perl-libwww
  perl-mime-lite
  perl-mime-tools
  perl-php-serialization
  perl-net-sftp-foreign
  perl-sys-mmap
  perl-time-modules
  perl-x10
  php
  php-apache
  php-gd
  php-mcrypt
)
makedepends=(
  netpbm
)
optdepends=(
  netpbm
)
install=$pkgbase.install
source=(
  https://github.com/ZoneMinder/ZoneMinder/archive/v$pkgver.tar.gz
  httpd-$pkgbase.conf
  $pkgbase
  $pkgbase.service
)
sha512sums=(
  8a349558399381a9062365ddc8bd8f815e3800929914096b2e4ea63e4d6dd12054f7b849fab5bea4bcfc87ea60739479a55734c7075a74aab0622d35f1d2bb14
  fb9bf263c37fae30d775872a33cb319f2f2a7a4f38faff8c143253dbefd7278b295d0805e11ace6423a8ec2b50ef60f3426b6e6a53548c867ef7f109baa52c36
  ab4e1d5ddaf4d9cd53d6ca59d7965902afd6a2dc830fbbafa270736c52c2b3563075fee860bb0276466f96e9dbfb71b259ac45a4ae2e4ead8eaec154a0159eb0
  cfb0eb87a989236c72741a496ddc6a73aa2696e5beaaca4836d3c231ddb24c7ef5e9f65e7afa49674f2115cbfa4a07c75486e1947ce294c816ddbb875f3b99cf
)
build() {
  cd $srcdir/ZoneMinder-$pkgver
  ./bootstrap.sh


export CXXFLAGS=-D__STDC_CONSTANT_MACROS
./configure --prefix=/usr\
    --enable-debug=no\
    --enable-mmap=yes\
    --sysconfdir=/etc\
    --with-cgidir=/srv/http/cgi-bin\
    --with-extralibs='-L/usr/lib -L/usr/lib/mysql'\
    --with-libarch=lib\
    --with-ffmpeg=/usr \
    --with-mysql=/usr\
    --with-webdir=/srv/http/$pkgbase\
    --with-webgroup=http\
    --with-webhost=localhost\
    --with-webuser=http \

  make V=0
}

package() {
  cd $srcdir/ZoneMinder-$pkgver

  make DESTDIR=$pkgdir install

  mkdir -p $pkgdir/{etc/{httpd/conf/extra,rc.d},srv/http/{cgi-bin,$pkgbase},usr/{lib/systemd/system,share/{license/$pkgbase,$pkgbase/db}},var/{cache/$pkgbase,log/$pkgbase}}
  mkdir -p $pkgdir/srv/zoneminder/socks
  chown -R http.http $pkgdir/{etc/zm.conf,var/{cache/$pkgbase,log/$pkgbase}}
  chown -R http.http $pkgdir/srv/zoneminder/socks
  chmod 0700 $pkgdir/etc/zm.conf

  for i in events images temp; do
    mv    $pkgdir/srv/http/$pkgbase/$i $pkgdir/var/cache/$pkgbase/$i
    ln -s /var/cache/$pkgbase/$i       $pkgdir/srv/http/$pkgbase/$i
    chown -h http.http                 $pkgdir/srv/http/$pkgbase/$i
  done

  ln -s /srv/http/cgi-bin                  $pkgdir/srv/http/$pkgbase
  chown -h http.http                       $pkgdir/srv/http/{cgi-bin,$pkgbase,$pkgbase/cgi-bin}

  ln -s /usr/share/cambozola/cambozola.jar $pkgdir/srv/http/$pkgbase

  install -D -m 644 $srcdir/httpd-$pkgbase.conf $pkgdir/etc/httpd/conf/extra
  install -D -m 644 $srcdir/$pkgbase            $pkgdir/etc/rc.d
  install -D -m 644 $srcdir/$pkgbase.service    $pkgdir/usr/lib/systemd/system
  install -D -m 644 COPYING                     $pkgdir/usr/share/license/$pkgbase
  install -D -m 644 db/zm*.sql                  $pkgdir/usr/share/$pkgbase/db
}
* TEMP
  + https://github.com/eyezm/ZoneMinder/blob/master/src/zm_remote_camera_http.cpp
  + http://www.ipcamtalk.com/showthread.php?144-Foscam-FI8910W-Firmware-Update-March-20-2014
  + http://foscam.us/forum/fi8910w-zoneminder-corrupt-jpeg-data-t1782.html
  + http://mainstreetanswers.org/foscam.php
  + http://foscam.us/forum/fi9802w-can-t-get-motionn-jpeg-on-zoneminder-t4822.html
  + http://lachlanmiskin.com/blog/2012/06/25/zoneminder-foscam-fi8918w-war-corrupt-jpeg-data-extraneous-bytes-before-marker-0xd9/
  + http://www-personal.umd.umich.edu/~dennismv/corruptjpeg.html
  + http://foscam.us/forum/fi9802w-can-t-get-motionn-jpeg-on-zoneminder-t4822.html
  + http://sighworld.com/category/zoneminder/
  + https://bugs.launchpad.net/ubuntu/+source/zoneminder/+bug/1159361
* https://wiki.archlinux.org/index.php/PKGBUILD
* Changelog
** Sun Sep 28 12:23:24 PDT 2014 [zoneminder.service]
   I copied the zoneminder.service file found in the misc folder
** Sun Sep 28 12:34:06 PDT 2014 [/var/run/zm/zm.pid]
** Sun Sep 28 12:49:01 PDT 2014 \|^;extension=pdo_mysql.so$| s|^;||;
   
   
   
   

